import{s as f,t as h}from"./utils.BlG4sr4w.js";function b(t,i,n){return new Promise((e,r)=>{chrome.tabs.sendMessage(t,{method:i,payload:n},a=>{chrome.runtime.lastError?r(chrome.runtime.lastError):e(a)})})}const m=async(t,i,n=1)=>{var a;let e={active:!0,currentWindow:!0},r=(await chrome.tabs.query(e))[0];if((a=r.url)!=null&&a.startsWith("chrome")&&(e={active:!1,currentWindow:!0},r=(await chrome.tabs.query(e))[0]),!(r!=null&&r.id))throw new Error("No active tab found");return p(r.id,t,i,n)},p=async(t,i,n,e=2)=>{let r;for(let a=0;a<e;a++)try{return await b(t,i,n)}catch(s){a===e-1?r=s:(console.error(s),await f(1e3))}throw r};async function w(){const t=await m("getAnnotatedDOM",[],3);if(!t||typeof t!="string")return null;const i=new DOMParser().parseFromString(t,"text/html"),n=[];return l(i.documentElement,n)}function l(t,i){var u;if(t.nodeType===Node.TEXT_NODE&&((u=t.textContent)!=null&&u.trim()))return document.createTextNode(t.textContent+" ");if(!(t instanceof HTMLElement||t instanceof SVGElement)||!(t.getAttribute("data-visible")==="true"))return null;let e=Array.from(t.childNodes).map(o=>l(o,i)).filter(h);t.tagName==="BODY"&&(e=e.filter(o=>o.nodeType!==Node.TEXT_NODE));const r=t.getAttribute("data-interactive")==="true"||t.hasAttribute("role"),a=t.hasAttribute("aria-label")||t.hasAttribute("name"),s=r||a;if(!s&&e.length===0)return null;if(!s&&e.length===1)return e[0];const c=document.createElement(t.tagName),d=["aria-label","data-name","name","type","placeholder","value","role","title"];for(const o of d)t.hasAttribute(o)&&c.setAttribute(o,t.getAttribute(o));return r&&(i.push(t),c.setAttribute("id",t.getAttribute("data-id"))),e.forEach(o=>c.appendChild(o)),c}export{m as a,l as b,p as c,w as g};
